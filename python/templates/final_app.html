<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Research Field Similarity Tool - Compare and analyze research fields">
    <title>Research Field Similarity Tool</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
</head>
<body>
    <!-- Accessibility skip link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/" aria-label="Research Field Similarity Tool Home">
                <i class="fas fa-project-diagram me-2" aria-hidden="true"></i>
                Research Field Similarity
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#add-field-section">
                            <i class="fas fa-plus-circle me-1" aria-hidden="true"></i> Add New Field
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#view-similarity-section">
                            <i class="fas fa-chart-bar me-1" aria-hidden="true"></i> View Similarities
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#recalculate-similarity-section">
                            <i class="fa-solid fa-arrow-rotate-right me-2"></i>Recalculate Similarities
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#helpModal">
                            <i class="fas fa-question-circle me-1" aria-hidden="true"></i> Help
                        </a>
                    </li>
                </ul>
                <div class="d-flex">
                    <button id="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                        <i class="fas fa-moon" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Alert Container -->
    <div id="alert-container" role="alert" aria-live="polite"></div>

    <!-- Main Content -->
    <div class="container" id="main-content">
        <!-- Page Header -->
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-5 fw-bold">
                    <i class="fas fa-project-diagram me-2 text-primary" aria-hidden="true"></i>
                    Research Field Similarity Tool
                </h1>
            </div>
        </div>
        
        <!-- Add New Field Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card" id="add-field-section">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">
                            <i class="fas fa-plus-circle me-2" aria-hidden="true"></i>
                            Add New Field
                        </h2>
                    </div>
                    <div class="card-body">
                        <form id="add-field-form" novalidate>
                            <!-- Field Name -->
                            <div class="form-group">
                                <label for="field-name" class="form-label">Field Name:</label>
                                <input type="text" class="form-control" id="field-name" name="name" required 
                                       aria-describedby="field-name-help" placeholder="e.g., Quantum Computing">
                                <div id="field-name-help" class="help-text">Enter a unique, descriptive name for the research field</div>
                                <div class="invalid-feedback">Please provide a field name</div>
                            </div>
                            
                            <!-- Group Selection -->
                            <div class="form-group">
                                <label for="field-group" class="form-label">Group:</label>
                                <select class="form-select" id="field-group" name="group" required aria-describedby="field-group-help">
                                    <option value="">Select a group</option>
                                    {% for group in groups %}
                                    <option value="{{ group }}">{{ group }}</option>
                                    {% endfor %}
                                    <option value="new">+ Add New Group</option>
                                </select>
                                <div id="field-group-help" class="help-text">The high-level category this field belongs to</div>
                                <input type="text" class="form-control mt-2" id="new-group" placeholder="Enter new group name" 
                                       aria-label="New group name" style="display: none;">
                                <div class="invalid-feedback">Please select or create a group</div>
                            </div>
                            
                            <!-- Subgroup Selection -->
                            <div class="form-group">
                                <label for="field-subgroup" class="form-label">Subgroup:</label>
                                <select class="form-select" id="field-subgroup" name="subgroup" required aria-describedby="field-subgroup-help">
                                    <option value="">Select a group first</option>
                                </select>
                                <div id="field-subgroup-help" class="help-text">The specific subcategory within the selected group</div>
                                <input type="text" class="form-control mt-2" id="new-subgroup" placeholder="Enter new subgroup name" 
                                       aria-label="New subgroup name" style="display: none;">
                                <div class="invalid-feedback">Please select or create a subgroup</div>
                            </div>
                            
                            <!-- Description Notice -->
                            <div class="alert alert-info mt-4 mb-3" role="alert">
                                <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
                                <span>Complete the sections below to describe the field in detail. More comprehensive descriptions lead to more accurate similarity calculations.</span>
                            </div>
                            
                            <!-- Field Definition -->
                            <div class="form-group">
                                <label for="field-definition" class="form-label">Definition:</label>
                                <textarea class="form-control" id="field-definition" name="definition" rows="3" 
                                          placeholder="Provide a concise definition of the field" aria-describedby="definition-help"></textarea>
                                <div id="definition-help" class="help-text">What is this field about? What are its core principles?</div>
                            </div>
                            
                            <!-- Methodologies -->
                            <div class="form-group">
                                <label for="field-methodologies" class="form-label">Methodologies:</label>
                                <textarea class="form-control" id="field-methodologies" name="methodologies" rows="3" 
                                          placeholder="Describe key methodologies used in this field" aria-describedby="methodologies-help"></textarea>
                                <div id="methodologies-help" class="help-text">What approaches, techniques, and methods are used in this field?</div>
                            </div>
                            
                            <!-- Applications -->
                            <div class="form-group">
                                <label for="field-applications" class="form-label">Applications:</label>
                                <textarea class="form-control" id="field-applications" name="applications" rows="3" 
                                          placeholder="List practical applications of this field" aria-describedby="applications-help"></textarea>
                                <div id="applications-help" class="help-text">How is this field applied in real-world contexts?</div>
                            </div>
                            
                            <!-- Technologies -->
                            <div class="form-group">
                                <label for="field-technologies" class="form-label">Technologies:</label>
                                <textarea class="form-control" id="field-technologies" name="technologies" rows="3" 
                                          placeholder="Describe technologies associated with this field" aria-describedby="technologies-help"></textarea>
                                <div id="technologies-help" class="help-text">What tools, platforms, or technical systems are used?</div>
                            </div>
                            
                            <!-- Challenges -->
                            <div class="form-group">
                                <label for="field-challenges" class="form-label">Challenges:</label>
                                <textarea class="form-control" id="field-challenges" name="challenges" rows="3" 
                                          placeholder="Describe key challenges in this field" aria-describedby="challenges-help"></textarea>
                                <div id="challenges-help" class="help-text">What are the current limitations or difficulties in this field?</div>
                            </div>
                            
                            <!-- Future Directions -->
                            <div class="form-group">
                                <label for="field-future" class="form-label">Future Directions:</label>
                                <textarea class="form-control" id="field-future" name="future_directions" rows="3" 
                                          placeholder="Describe potential future developments" aria-describedby="future-help"></textarea>
                                <div id="future-help" class="help-text">Where is this field heading? What new developments are emerging?</div>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="d-flex justify-content-center mt-3">
                                <button type="submit" class="btn btn-primary mt-3" id="add-field-btn">
                                    
                                    Add Field & Calculate Similarities
                                </button>
                            </div>
                        </form>
                        
                        <!-- Loading Indicator -->
                        <div class="loading" id="add-field-loading" style="display: none;">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-center">Adding field and calculating similarities...</p>
                            <p class="small text-muted text-center">This may take a few moments, especially for detailed descriptions.</p>
                        </div>

                        <!-- Success Message -->
                        <div class="mt-4" id="download-section" style="display: none;">
                            <div class="alert alert-success" role="alert">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-check-circle fs-3 me-3" aria-hidden="true"></i>
                                    <div>
                                        <h4 class="alert-heading h5 mb-1">Success!</h4>
                                        <p class="mb-2">Field added successfully! Similarities have been calculated.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Field Deletion Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card" id="delete-field-section">
            <div class="card-header bg-danger text-white">
                <h2 class="h5 mb-0">
                    <i class="fas fa-trash me-2" aria-hidden="true"></i>
                    Delete Fields
                </h2>
            </div>
            <div class="card-body">
               
                
                <form id="delete-field-form">
                    <div class="row align-items-end">
                        <div class="col-md-8">
                            <div class="form-group">
                              
                                <select class="form-select" id="field-to-delete" name="field-to-delete" required>
                                    <option value="">Select a field to Delete</option>
                                    {% for field in field_names %}
                                    <option value="{{ field }}">{{ field }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">Please select a field</div>
                                <div class="help-text mt-2">
                                    <i class="fas fa-info-circle me-1" aria-hidden="true"></i>
                                    This will delete the selected field and all its associated similarities.
                                </div>
        
                            </div>
                            
                        </div>
                     
                        <div class="d-flex justify-content-center mt-3">
                            <button type="submit" class="btn btn-danger w-10" id="submit-delete-btn" disabled>
                                <i class="fas fa-trash me-2" aria-hidden="true"></i>
                                Delete Field
                            </button>
                        </div>
                    </div>
                </form>
                
                <!-- Status section - shows after deletion attempt -->
                <div id="delete-status" class="mt-4" style="display: none;">
                    <!-- Will be populated by JS with status of delete operation -->
                </div>
            </div>
        </div>
    </div>
</div>
          
        <!-- View Field Similarities Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card" id="view-similarity-section">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">
                            <i class="fas fa-chart-bar me-2" aria-hidden="true"></i>
                            View Field Similarities
                        </h2>
                    </div>
                    <div class="card-body">
                        <!-- Field Selection Form -->
                        <form id="view-similarity-form">
                            <div class="form-group">
                             
                                <select class="form-select" id="field1" name="field1" required>
                                    <option value="">Select a field</option>
                                    {% for field in field_names %}
                                    <option value="{{ field }}">{{ field }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">Please select a field</div>
                                <div class="help-text mt-2">
                                    <i class="fas fa-info-circle me-1" aria-hidden="true"></i>
                                    This will show similarities between the selected field and all other fields.
                                </div>
                            </div>
                            
                            <div class="d-flex justify-content-center mt-3">
                                <button type="submit" class="btn btn-primary">
                                  
                                    View Similarities
                                </button>
                            </div>
                        </form>
                        
                        <!-- Loading Indicator -->
                        <div class="loading" id="view-similarity-loading" style="display: none;">
                            <div class="spinner-border" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-3 text-center">Retrieving similarity data...</p>
                        </div>
                        
                        <!-- Results Section -->
                        <div id="similarity-results" class="mt-4" style="display: none;">
                            <h3 class="h5 mb-4 text-center">
                                <i class="fas fa-chart-line me-2 text-primary" aria-hidden="true"></i>
                                Similarity Results for <span id="selected-field-name">Field</span>
                            </h3>
                            
                            <!-- Results Table -->
                            <div class="card mb-4">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <h4 class="h6 mb-0">All Field Similarities</h4>
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="sort-by-similarity" checked>
                                            <label class="form-check-label" for="sort-by-similarity">Sort by similarity</label>
                                        </div>
                                    </div>
                                    
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Field</th>
                                                    <th>Group</th>
                                                    <th class="text-end">Similarity</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="similarity-table-body">
                                                <!-- Will be populated by JS -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Selected Field Details -->
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="h6 mb-3">Selected Field Details</h4>
                                    <div class="accordion" id="field-details-accordion">
                                        <div class="accordion-item">
                                            <h2 class="accordion-header">
                                                <button class="accordion-button" type="button" data-bs-toggle="collapse" 
                                                        data-bs-target="#field1-details" aria-expanded="true" aria-controls="field1-details">
                                                    <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
                                                    <span id="accordion-field1-name">Field</span> Details
                                                </button>
                                            </h2>
                                            <div id="field1-details" class="accordion-collapse collapse show" 
                                                 data-bs-parent="#field-details-accordion">
                                                <div class="accordion-body" id="field1-details-content">
                                                    <!-- Details will be populated by JS -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recalculate Similarities Section -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm" id="recalculate-similarity-section">
                    <div class="card-header bg-primary text-white">
                        <h2 class="h5 mb-0">
                            <i class="fa-solid fa-arrow-rotate-right me-2"></i>
                            Recalculate Similarities
                        </h2>
                    </div>
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h6 class="text-muted">Field Similarity Calculation</h6>
                                <p class="text-secondary small mb-0">Recalculates similarity scores between all research field pairs and updates the JSON.</p>
                            </div>
                           
                            <div class="d-flex justify-content-center mt-3">
                                <button id="recalculate-btn" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#recalculateModal">
                                  Recalculate Similarities
                                </button>
                            </div>
                        </div>
                        <div id="recalculate-status" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="d-flex mb-3">
                    <div class="me-3">
                        <i class="fas fa-exclamation-triangle fa-3x text-warning"></i>
                    </div>
                    <div>
                        <h5 class="mt-1">Permanently Delete Field</h5>
                        <p class="mb-0">You are about to delete: <strong id="confirm-field-name">Field Name</strong></p>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <p class="mb-0"><strong>Warning:</strong> This action cannot be undone. The field will be permanently removed from the database, and all similarities will be recalculated.</p>
                </div>
                
                <div class="mt-3">
                    <p class="text-muted small mb-0">After deletion, the updated similarity scores will be saved to <code>final_outputs_enhanced_multi/field_similarities.json</code>.</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">
                    <i class="fas fa-trash me-2"></i>Delete Field
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Progress Modal -->
<div class="modal fade" id="deleteProgressModal" tabindex="-1" aria-labelledby="deleteProgressModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="deleteProgressModalLabel">Deleting Field</h5>
            </div>
            <div class="modal-body">
                <div class="text-center mb-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <h5 class="text-center mb-3">Processing Deletion</h5>
                <div class="progress mb-4">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <p class="text-center text-muted">
                    Deleting field and recalculating all similarities.<br>
                    This may take a few moments. Please do not close this window.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Delete Result Modal -->
<div class="modal fade" id="deleteResultModal" tabindex="-1" aria-labelledby="deleteResultModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" id="delete-result-header">
                <h5 class="modal-title" id="deleteResultModalLabel">Deletion Complete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="delete-result-content">
                <!-- Will be populated dynamically -->
            </div>
            <div class="modal-footer" id="delete-result-footer">
                <a href="/api/download_similarities" class="btn btn-success" download>
                    <i class="fas fa-download me-2"></i>Download Updated Data
                </a>
                <button type="button" class="btn btn-primary" id="delete-result-close" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <!-- MODALS -->
     <!-- Delete Field Modal -->
<div class="modal fade" id="deleteFieldModal" tabindex="-1" aria-labelledby="deleteFieldModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="deleteFieldModalLabel">Delete Field</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Confirmation View -->
                <div id="delete-modal-confirmation">
                    <p><i class="fas fa-exclamation-triangle text-danger me-2"></i> You are about to delete the field: <strong id="delete-field-name">Field Name</strong></p>
                    <div class="alert alert-warning">
                        <div class="d-flex">
                            <div class="me-3">
                                <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                            </div>
                            <div>
                                <p class="mb-0"><strong>Warning:</strong> This action cannot be undone. All similarities associated with this field will also be removed.</p>
                            </div>
                        </div>
                    </div>
                    <p class="small text-muted">After deletion, similarity scores in <code>final_outputs_enhanced_multi/field_similarities.json</code> will be updated.</p>
                </div>
                
                <!-- Progress View -->
                <div id="delete-modal-progress" class="d-none">
                    <div class="text-center mb-3">
                        <div class="spinner-border text-danger" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                    <h6 class="text-center mb-3">Deleting Field & Updating Similarities</h6>
                    <div class="progress mb-3">
                        <div id="delete-calculation-progress" class="progress-bar bg-danger progress-bar-striped progress-bar-animated" 
                            role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <p id="delete-calculation-status" class="text-center text-muted small">This may take a few moments. Please do not close this window.</p>
                </div>
                
                <!-- Result View -->
                <div id="delete-modal-result" class="d-none">
                    <div id="delete-result-content"></div>
                </div>
            </div>
            <div class="modal-footer">
                <!-- Confirmation Buttons -->
                <div id="delete-modal-confirmation-buttons">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" id="confirm-delete-field" class="btn btn-danger">Delete Field</button>
                </div>
                
                <!-- Progress Buttons -->
                <div id="delete-modal-progress-buttons" class="d-none w-100 text-center">
                    <p class="small text-muted mb-0">Please wait while the field is being deleted and similarities updated...</p>
                </div>
                
                <!-- Result Buttons -->
                <div id="delete-modal-result-buttons" class="d-none">
                    <a href="/api/download_similarities" class="btn btn-success" download>
                        <i class="fas fa-download me-2"></i>Download Updated Data
                    </a>
                    <button type="button" class="btn btn-primary" id="delete-modal-close" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
    
    <!-- Add Field Modal -->
    <div class="modal fade" id="addFieldModal" tabindex="-1" aria-labelledby="addFieldModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="addFieldModalLabel">Add New Field</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Confirmation View -->
                    <div id="add-modal-confirmation">
                        <p><i class="fas fa-info-circle text-primary me-2"></i> This will add a new research field and calculate its similarities with all existing fields.</p>
                        <div class="alert alert-warning">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                                </div>
                                <div>
                                    <p class="mb-0"><strong>Please note:</strong> This operation may take a few moments to complete, especially for detailed descriptions.</p>
                                </div>
                            </div>
                        </div>
                        <p class="small text-muted">New similarity scores will be added to <code>final_outputs_enhanced_multi/field_similarities.json</code>.</p>
                    </div>
                    
                    <!-- Progress View -->
                    <div id="add-modal-progress" class="d-none">
                        <div class="text-center mb-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <h6 class="text-center mb-3">Adding Field & Calculating Similarities</h6>
                      
                        <p id="add-calculation-status" class="text-center text-muted small">This may take a few moments. Please do not close this window.</p>
                    </div>
                    
                    <!-- Result View -->
                    <div id="add-modal-result" class="d-none">
                        <div id="add-result-content"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- Confirmation Buttons -->
                    <div id="add-modal-confirmation-buttons">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" id="confirm-add-field" class="btn btn-primary">Add Field & Calculate Similarities</button>
                    </div>
                    
                    <!-- Progress Buttons -->
                    <div id="add-modal-progress-buttons" class="d-none w-100 text-center">
                        <p class="small text-muted mb-0">Please wait while the field is being added and similarities calculated...</p>
                    </div>
                    
                    <!-- Result Buttons -->
                    <div id="add-modal-result-buttons" class="d-none">
                        <a href="/api/download_similarities" class="btn btn-success" download>
                            <i class="fas fa-download me-2"></i>Download Updated Data
                        </a>
                        <button type="button" class="btn btn-primary" id="add-modal-close" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recalculate Modal -->
    <div class="modal fade" id="recalculateModal" tabindex="-1" aria-labelledby="recalculateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="recalculateModalLabel">Recalculate Field Similarities</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Confirmation View -->
                    <div id="modal-confirmation">
                        <p><i class="fas fa-info-circle text-primary me-2"></i> This will recalculate similarity scores between <strong>all pairs of research fields</strong> in the system.</p>
                        <div class="alert alert-warning">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
                                </div>
                                <div>
                                    <p class="mb-0"><strong>Please note:</strong> This operation may take several minutes to complete, depending on the number of fields in the database.</p>
                                </div>
                            </div>
                        </div>
                        <p class="small text-muted">The existing similarity scores in <code>final_outputs_enhanced_multi/field_similarities.json</code> will be overwritten.</p>
                    </div>
                    
                    <!-- Progress View -->
                    <div id="modal-progress" class="d-none">
                        <div class="text-center mb-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>
                        <h6 class="text-center mb-3">Recalculating Similarities</h6>
                     
                        <p id="calculation-status" class="text-center text-muted small">This may take several minutes. Please do not close this window.</p>
                    </div>
                    
                    <!-- Result View -->
                    <div id="modal-result" class="d-none">
                        <div id="result-content"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <!-- Confirmation Buttons -->
                    <div id="modal-confirmation-buttons">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" id="confirm-recalculate" class="btn btn-primary">Proceed with Recalculation</button>
                    </div>
                    
                    <!-- Progress Buttons -->
                    <div id="modal-progress-buttons" class="d-none w-100 text-center">
                        <p class="small text-muted mb-0">Please wait while similarities are being calculated...</p>
                    </div>
                    
                    <!-- Result Buttons -->
                    <div id="modal-result-buttons" class="d-none">
                        <a href="/api/download_similarities" class="btn btn-success" download>
                            <i class="fas fa-download me-2"></i>Download Updated Data
                        </a>
                        <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Field Comparison Modal -->
    <div class="modal fade" id="comparisonModal" tabindex="-1" aria-labelledby="comparisonModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="comparisonModalLabel">Field Comparison</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- Similarity Gauge -->
                    <div class="d-flex justify-content-center mb-4">
                        <div class="similarity-gauge mb-2">
                            <div class="similarity-gauge-circle" id="modal-gauge-circle">
                                <div class="similarity-gauge-inner">
                                    <h5 class="similarity-score mb-0" id="modal-similarity-score">0</h5>
                                    <small class="text-muted">Similarity</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Field Names -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="field-card">
                                <h5 class="field-name" id="modal-field1-name">Field 1</h5>
                                <p class="field-group mb-0 d-none" id="modal-field1-group">Group › Subgroup</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="field-card">
                                <h5 class="field-name" id="modal-field2-name">Field 2</h5>
                                <p class="field-group mb-0 d-none" id="modal-field2-group">Group › Subgroup</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Similarity Interpretation -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <h6 class="mb-2">Similarity Interpretation</h6>
                            <div id="modal-interpretation-text" class="mb-2">
                                <!-- Will be populated by JS -->
                            </div>
                            <div class="progress similarity-progress d-none">
                                <div class="progress-bar" id="modal-similarity-progress-bar" role="progressbar" 
                                    style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Field Details Accordion -->
                    <div class="accordion" id="modal-field-details-accordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                                        data-bs-target="#modal-field2-details" aria-expanded="false" aria-controls="modal-field2-details">
                                    <i class="fas fa-info-circle me-2" aria-hidden="true"></i>
                                    <span id="modal-accordion-field2-name">Compared Field</span> Details
                                </button>
                            </h2>
                            <div id="modal-field2-details" class="accordion-collapse collapse" 
                                 data-bs-parent="#modal-field-details-accordion">
                                <div class="accordion-body" id="modal-field2-details-content">
                                    <!-- Details will be populated by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Help Modal -->
<div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="helpModalLabel">
                    <i class="fas fa-question-circle me-2" aria-hidden="true"></i>
                    Help & Information
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5 class="mb-3">About This Tool</h5>
                <p>
                    The Research Field Similarity Tool allows you to compare research fields and calculate 
                    similarity scores based on comprehensive analysis of their descriptions, methodologies, 
                    applications, and other characteristics.
                </p>
                
                <h5 class="mb-3 mt-4">Page Layout</h5>
                <p>
                    This tool has three main sections:
                </p>
                <ul>
                    <li><strong>Add New Field</strong> (top section) - Add new research fields to the database</li>
                    <li><strong>Delete Fields</strong> (middle section) - Remove fields and recalculate similarities</li>
                    <li><strong>View Field Similarities</strong> (bottom section) - Compare and analyze similarities between fields</li>
                </ul>
                <p>Use the navigation links in the top menu bar to quickly jump between sections without scrolling.</p>
                
                <h5 class="mb-3 mt-4">How to Use</h5>
                <div class="card mb-3">
                    <div class="card-body">
                        <h6><i class="fas fa-plus-circle me-2 text-primary" aria-hidden="true"></i> Add a New Field</h6>
                        <ol>
                            <li>Enter a unique name for the field</li>
                            <li>Select or create a group and subgroup for organizational purposes</li>
                            <li>Fill in the description sections with detailed information</li>
                            <li>Click "Add Field & Calculate Similarities" to save the field and compute similarities with existing fields</li>
                            <li>Download the updated similarities file if needed</li>
                        </ol>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <h6><i class="fas fa-trash me-2 text-danger" aria-hidden="true"></i> Delete Fields</h6>
                        <ol>
                            <li>Select a field from the dropdown menu</li>
                            <li>Click the "Delete Field" button</li>
                            <li>Confirm the deletion in the modal that appears</li>
                            <li>Wait for the system to delete the field and recalculate all similarities</li>
                            <li>Review the results and download the updated data if needed</li>
                        </ol>
                        <p class="small text-danger mb-0"><strong>Note:</strong> Field deletion is permanent and will trigger a complete recalculation of all similarity scores between remaining fields.</p>
                    </div>
                </div>
                
                <div class="card mb-3">
                    <div class="card-body">
                        <h6><i class="fas fa-chart-bar me-2 text-primary" aria-hidden="true"></i> View Field Similarities</h6>
                        <ol>
                            <li>Select a field from the dropdown menu</li>
                            <li>Click "View Similarities" to see how similar this field is to all other fields</li>
                            <li>Sort the results by similarity score or alphabetically</li>
                            <li>Click the "Eye" icon to view detailed comparison with any specific field</li>
                        </ol>
                    </div>
                </div>
                
                <h5 class="mb-3 mt-4">Navigation Tips</h5>
                <div class="card mb-3">
                    <div class="card-body">
                        <p>The fixed navigation bar at the top of the page gives you quick access to all sections:</p>
                        <ul>
                            <li>Click <strong>Add New Field</strong> to jump to the top section</li>
                            <li>Click <strong>Delete Fields</strong> to jump to the field deletion section</li>
                            <li>Click <strong>View Similarities</strong> to jump to the comparison section</li>
                        </ul>
                        <p>This eliminates the need for excessive scrolling, especially on larger screens.</p>
                    </div>
                </div>
                
                <h5 class="mb-3 mt-4">Similarity Calculation</h5>
                <p>
                    Similarities are calculated using a sophisticated algorithm that considers multiple factors:
                </p>
                <ul>
                    <li><strong>Semantic Similarity:</strong> Analyzes the meaning and context of descriptions</li>
                    <li><strong>Term-Based Analysis:</strong> Examines key terminology and technical concepts</li>
                    <li><strong>Domain Relationships:</strong> Considers connections between different research domains</li>
                    <li><strong>Organizational Structure:</strong> Takes into account group and subgroup relationships</li>
                </ul>
                
                <h5 class="mb-3 mt-4">Interpreting Similarity Scores</h5>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="text-success">High Similarity (0.7-1.0)</h6>
                                <p class="small mb-0">Fields are closely related with substantial overlap in concepts, methodologies, and applications.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="text-primary">Medium Similarity (0.4-0.7)</h6>
                                <p class="small mb-0">Fields have notable connections with some shared characteristics or approaches.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h6 class="text-secondary">Low Similarity (0.0-0.4)</h6>
                                <p class="small mb-0">Fields are mostly distinct with limited conceptual or methodological overlap.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h5 class="mb-3 mt-4">Data Management</h5>
                <div class="card mb-3">
                    <div class="card-body">
                        <p>The system maintains two key data files:</p>
                        <ul>
                            <li><strong>Field Descriptions:</strong> Contains all field data, including descriptions, grouped by category and subcategory</li>
                            <li><strong>Field Similarities:</strong> Contains all calculated similarity scores between field pairs</li>
                        </ul>
                        <p class="mb-0">When you add or delete fields, these files are automatically updated to maintain consistency.</p>
                    </div>
                </div>
                
                <h5 class="mb-3 mt-4">Keyboard Shortcuts</h5>
                <div class="row">
                    <div class="col-md-6">
                        <ul>
                            <li><strong>Alt + A:</strong> Jump to Add Field section</li>
                            <li><strong>Alt + V:</strong> Jump to View Similarities section</li>
                            <li><strong>Alt + H:</strong> Open this help dialog</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul>
                            <li><strong>Alt + D:</strong> Toggle dark/light mode</li>
                            <li><strong>Alt + S:</strong> Submit current form</li>
                            <li><strong>Esc:</strong> Close dialogs or clear selections</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>